;/*FB_PKG_DELIM*/

__d("MAWEncryptedBackupsUpdateGlobalRestoreStatus",["WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h,i=new Set(),j=new Set();function k(a){if(a==="restore")return i;else return j}function a(a,b){b=k(b);b.add(a)}function b(a,b){b=k(b);b.has(a)?b["delete"](a):d("WALogger").WARN(h||(h=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Thread with thread id "," is not currently being tracked, but restore seems to be in progress"])),a)}function c(a){a=k(a);return a.size}g.addThreadIdToStatusArray=a;g.removeThreadIdFromStatusArray=b;g.getCurrentGlobalRestoreStatusArrayLength=c}),98);
__d("MAWRestoreMessagesFromEncryptedBackupsNOP",["EBLogger","ExecutionEnvironment","I64","LSDataTraceCheckPoint","LSIntEnum","LSMEBTaskCreationSource","MAWAsyncEBPendingQueryPromise","MAWBridgeTraceRecordCheckpointHandler","MAWBridgeUpdateClientRestoreStatus","MAWChatJid","MAWEBRestoreTrackingUtils","MAWEncryptedBackupsUpdateGlobalRestoreStatus","MAWJobDefinitions","MAWJobManager","MAWOfflineQueueStatus","MAWTimedJob","MAWUpdateClientRestoreStatusOperationType","ReQL","WAJobOrchestratorTypes","WATagsLogger","cr:4992","err"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n,o;async function p(a,b){try{b=await d("MAWChatJid").toThreadKeyMaybeForChatJidInteger(a,(n||(n=d("I64"))).of_string(b));if(b!=null){a=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.messages_ranges_v2__generated).getKeyRange(b));if(a!=null)return a.minMessageId}}catch(a){return Promise.reject(a)}return}function q(a,b,c){if(b===0)return d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.mi_act_mapping_table)).then(function(a){a.forEach(function(a){a=d("MAWJobDefinitions").toThreadJidPrimaryId((n||(n=d("I64"))).to_string(a.jid));d("MAWEncryptedBackupsUpdateGlobalRestoreStatus").addThreadIdToStatusArray(a,"restore");c&&d("MAWEncryptedBackupsUpdateGlobalRestoreStatus").addThreadIdToStatusArray(a,"ebprefetch")})})}async function a(a,e,f,g,m,s,t,u,v,w,x,y,z,A,B){A===void 0&&(A=d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION);d("WATagsLogger").TAGS(["labyrinth_web","eb_restore",w!=null?w:""]).LOG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web][","] Received echo documents for thread: "," startSortKey: "," messagesCount: ",""])),w!=null?w:"",f,x,g.length);B=await d("MAWChatJid").toThreadKeyMaybeForChatJidInteger(a,(n||(n=d("I64"))).of_string(f));B==null&&d("EBLogger").EBLogger().MUSTFIX(i||(i=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Failed to get thread key for "," when calling restoreMessagesFromEncryptedBackup"])),f);B=!d("MAWOfflineQueueStatus").isOfflineQueueComplete()&&b("cr:4992")!=null&&x==null&&f!=null;var C=d("MAWEncryptedBackupsUpdateGlobalRestoreStatus").getCurrentGlobalRestoreStatusArrayLength("restore");await q(a,C,B);try{C=await p(a,f);if(B&&b("cr:4992")!=null){d("WATagsLogger").TAGS(["labyrinth_web","eb_prefetch",w!=null?w:""]).LOG(j||(j=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Calling prefetch for thread ",""])),f);d("MAWEBRestoreTrackingUtils").markEBRestoreFrontloaded(y,w);B={action:d("MAWUpdateClientRestoreStatusOperationType").upsertClientRestoreStatus,threadId:f};await d("MAWBridgeUpdateClientRestoreStatus").call(a,B);await b("cr:4992")(a,e,f,g,m,s,t,u,v,w,x,C,y,z,A)}else{d("WATagsLogger").TAGS(["labyrinth_web","eb_restore",w!=null?w:""]).LOG(k||(k=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Calling worker job for thread "," StartSortKey: "," messagesCount: ",""])),f,x,g.length);return r(e,f,g,C,m,t,v,w,x,y,z,A).then(function(){w!=null&&d("MAWEBRestoreTrackingUtils").addQPLRestorePoint({pointName:"native_op_end",traceId:w})})}}catch(b){d("WATagsLogger").TAGS(["labyrinth_web","eb_restore",w!=null?w:""]).ERROR(l||(l=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Failed to restore messages for thread "," with error: ",""])),f,b);return w!=null?d("MAWBridgeTraceRecordCheckpointHandler").call(a,{checkPointId:(o||(o=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").FLOW_END_FOR_FAILURE),dataTraceId:w,errorMessage:b,shouldFlush:!0,syncChannel:-1,tags:void 0}).then(function(){return Promise.reject(b)}):Promise.reject(b)}}function r(a,b,e,f,g,h,i,j,k,l,n,o){var p=(m||(m=c("ExecutionEnvironment"))).isInWorker?d("MAWJobManager").getJobManager():d("MAWTimedJob").TimedUIJobStarters;if(j!=null&&l===c("LSMEBTaskCreationSource").MESSENGER_MESSAGE_LIST_PAGINATION)return p.waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.restoreMessagesFromEncryptedBackups(a,b,e,g,h,i,f!=null?f:void 0,j!=null?j:void 0,k!=null?k:void 0,void 0,void 0,l,{priority:o},n)).then(function(a){if(a.success===!0)d("MAWAsyncEBPendingQueryPromise").resolvePendingQueryUponReStore(j);else{var b;d("MAWAsyncEBPendingQueryPromise").rejectPendingQueryIfPresent(j,(b=a.payload)!=null?b:c("err")(a.error))}});return l===c("LSMEBTaskCreationSource").MEDIA_GALLERY_RESTORE?p.waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.restoreMessagesFromEncryptedBackups(a,b,e,g,h,i,f!=null?f:void 0,j!=null?j:void 0,k!=null?k:void 0,void 0,void 0,l,{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION},n)).then(function(){return Promise.resolve()}):Promise.resolve(p.fireAndForget(d("MAWJobDefinitions").jobSerializers.restoreMessagesFromEncryptedBackups(a,b,e,g,h,i,f!=null?f:void 0,j!=null?j:void 0,k!=null?k:void 0,void 0,void 0,l,{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION},n)))}g.call=a}),98);
__d("MWChatEncryptedBackupsAddonIcon.react",["MWAddOnCircleContainer.react","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react");function a(a){var b=d("react-compiler-runtime").c(3),e=a.ariaHidden;a=a.icon;var f;b[0]!==e||b[1]!==a?(f=i.jsx(c("MWAddOnCircleContainer.react"),{ariaHidden:e,size:36,children:a}),b[0]=e,b[1]=a,b[2]=f):f=b[2];return f}g["default"]=a}),98);